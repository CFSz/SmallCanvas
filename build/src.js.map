{"version":3,"sources":["HashObject.ts","EventObject.ts","DOM.ts","DisplayObject.ts","DisplayPool.ts","sys.ts"],"names":["smallcanvas","smallcanvas.HashObject","smallcanvas.HashObject.constructor","smallcanvas.EventObject","smallcanvas.EventObject.constructor","smallcanvas.EventObject.remove","smallcanvas.DOM","smallcanvas.DOM.constructor","smallcanvas.DOM.canvas","smallcanvas.DisplayObject","smallcanvas.DisplayObject.constructor","smallcanvas.DisplayObject.init","smallcanvas.DisplayObject.offsetWidth","smallcanvas.DisplayObject.offsetHeight","smallcanvas.DisplayObject.offsetX","smallcanvas.DisplayObject.offsetY","smallcanvas.DisplayObject.textureLoadHandle","smallcanvas.DisplayObject.addEventListener","smallcanvas.DisplayObject.removeEventListener","smallcanvas.DisplayObject.appendToStage","smallcanvas.DisplayPool","smallcanvas.DisplayPool.constructor","smallcanvas.init","smallcanvas.mainLoop","smallcanvas.render","smallcanvas.bindEvent","smallcanvas.bindEvent.getTouchPosition","smallcanvas.bindEvent.createDomEventHandle","smallcanvas.defaultHandle"],"mappings":"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","file":"src.js","sourcesContent":["/**\r\n * 为对象提供一个唯一的标识码\r\n */\r\nmodule smallcanvas {\r\n    export class HashObject {\r\n        public constructor() {\r\n            this.hashCode = HashObject.hashCount++;\r\n        }\r\n\r\n        public hashCode;\r\n        static hashCount = 1;\r\n    }\r\n}","/**\n * 事件池\n */\nmodule smallcanvas {\n    export class EventObject extends smallcanvas.HashObject {\n        public constructor(options) {\n            super();\n            //options = options || {};\n            //EventObject.eventPool[this.hashCode]=options;\n            this.target = options.target;\n            this.type = options.type;\n            this.successHandle = options.successHandle;\n            this.failHandle = options.failHandle;\n        }\n\n        public target;\n        public type;\n        public successHandle;\n        public failHandle;\n\n        public remove() {\n            delete EventObject.eventPool[this.hashCode];\n        }\n\n        public static eventPool = {};\n        public static DOMEventHandle = {};\n    }\n}","/**\r\n * DOM\r\n */\r\nmodule smallcanvas {\r\n    export class DOM {\r\n        public static _canvas = document.querySelector('canvas') || document.createElement('canvas');\r\n        public static ctx = DOM._canvas['getContext']('2d');\r\n\r\n        public static set canvas(dom) {\r\n            DOM.ctx = dom['getContext']('2d');\r\n        }\r\n\r\n        public static get canvas() {\r\n            return DOM._canvas;\r\n        }\r\n    }\r\n}","/**\r\n * 以图片为基础的显示对象\r\n */\r\n/// <reference path=\"HashObject.ts\" />\r\n/// <reference path=\"EventObject.ts\" />\r\n/// <reference path=\"DOM.ts\" />\r\nmodule smallcanvas {\r\n    export class DisplayObject extends smallcanvas.HashObject {\r\n        /**\r\n         * 显示对象,构建世界的基础\r\n         * @param canvas canvasDOM\r\n         * @param src 资源地址\r\n         * @param x 目标坐标x\r\n         * @param y 目标坐标y\r\n         * @param width 目标宽度\r\n         * @param height 目标高度\r\n         * @param anchorX 锚点X\r\n         * @param anchorY 锚点Y\r\n         * @param scale 缩放倍数\r\n         */\r\n        public constructor(options?) {\r\n            super();\r\n            options = options || {};\r\n            this.texture = new Image();\r\n            this.texture.src = options.src || 'images/error.png';\r\n            this.texture.onload = this.textureLoadHandle.bind(this);\r\n            this.texture[\"ready\"] = false;\r\n            this.x = options.x || 0;\r\n            this.y = options.y || 0;\r\n            this.width = options.width || 0;\r\n            this.height = options.height || 0;\r\n            this.anchorX = options.anchorX || 0;\r\n            this.anchorY = options.anchorY || 0;\r\n            this.scale = options.scale || 1;\r\n            this.init();\r\n        }\r\n\r\n\r\n        public texture;//图片素材\r\n        public x;//坐标x\r\n        public y;//坐标y\r\n        public width;//宽度\r\n        public height;//高度\r\n        public anchorX;//X偏移倍数\r\n        public anchorY;//Y偏移倍数\r\n        public scale = 1;\r\n        public eventPool = {};\r\n\r\n\r\n        /**\r\n         * 初始化\r\n         */\r\n        private init() {\r\n//            this.eventPoolHash=smallWheel.ads;\r\n            this.appendToStage();\r\n        }\r\n\r\n        /**\r\n         * 实际宽度\r\n         * @returns {number}\r\n         */\r\n        public get offsetWidth() {\r\n            return this.width * this.scale;\r\n        }\r\n\r\n        /**\r\n         * 实际高度\r\n         * @returns {number}\r\n         */\r\n        public get offsetHeight() {\r\n            return this.width * this.scale;\r\n        }\r\n\r\n        /**\r\n         * 实际x\r\n         * @returns {number}\r\n         */\r\n        public get offsetX() {\r\n            return this.x - this.width * this.anchorX;\r\n        }\r\n\r\n        /**\r\n         * 实际y\r\n         * @returns {number}\r\n         */\r\n        public get offsetY() {\r\n            return this.y - this.height * this.anchorY;\r\n        }\r\n\r\n        /**\r\n         * 处理资源加载完成事件\r\n         */\r\n        private textureLoadHandle() {\r\n            this.texture[\"ready\"] = true;\r\n            this.width = this.texture.width;\r\n            this.height = this.texture.height;\r\n        }\r\n\r\n\r\n        /**\r\n         * 绑定时间\r\n         * @param type 事件类型\r\n         * @param successHandle 判定成功的事件处理\r\n         * @param failHandle 判定失败的事件处理\r\n         */\r\n        public addEventListener(type, successHandle, failHandle?) {\r\n            var self = this;\r\n            var event = new smallcanvas.EventObject({\r\n                target: this,\r\n                //x: self.offsetX,\r\n                //y: self.offsetY,\r\n                //width: self.offsetWidth,\r\n                //height: self.offsetHeight,\r\n                type: type,\r\n                successHandle: successHandle || smallcanvas.defaultHandle,\r\n                failHandle: failHandle || smallcanvas.defaultHandle\r\n            });\r\n            this.eventPool[type + successHandle + failHandle] = event;\r\n        }\r\n\r\n        public removeEventListener(type, successHandle, failHandle) {\r\n            delete this.eventPool[type + successHandle + failHandle];\r\n        }\r\n\r\n        /**\r\n         * 绘制显示对象\r\n         */\r\n        public appendToStage() {\r\n            smallcanvas.DisplayPool.DisplayHash[this.hashCode] = this;\r\n        }\r\n\r\n    }\r\n}","/**\n * 显示对象池\n */\nmodule smallcanvas {\n    export class DisplayPool {\n        public static DisplayHash = {};\n    }\n}","/**\n * 程序入口\n */\nmodule smallcanvas {\n    export function init(dom?) {\n        //smallcanvas.DOM.canvas=dom||document.querySelector('canvas');\n        smallcanvas.mainLoop();\n        return smallcanvas;\n    }\n\n    export function mainLoop() {\n        render();\n        bindEvent();\n        window.requestAnimationFrame(smallcanvas.mainLoop)\n    }\n\n    export function render() {\n        for (var index in smallcanvas.DisplayPool.DisplayHash) {\n            var item = smallcanvas.DisplayPool.DisplayHash[index];\n            smallcanvas.DOM.ctx.clearRect(0, 0, smallcanvas.DOM.canvas['offsetWidth'], smallcanvas.DOM.canvas['offsetHeight']);\n            smallcanvas.DOM.ctx.drawImage(item.texture, item.offsetX, item.offsetY, item.offsetWidth, item.offsetHeight);\n        }\n    }\n\n    export function bindEvent() {\n        var eventTypeHash = {};\n        var EventObject = smallcanvas.EventObject;\n        /**\n         * 遍历显示对象,获得全部需要处理的Event\n         * 并根据type分组暂存至eventTypeHash\n         */\n        for (var index in smallcanvas.DisplayPool.DisplayHash) {\n            var item = smallcanvas.DisplayPool.DisplayHash[index];\n            for (var cIndex in item.eventPool) {\n                var cItem = item.eventPool[cIndex];\n                eventTypeHash[cItem.type] || (eventTypeHash[cItem.type] = []);\n                eventTypeHash[cItem.type].push({\n                    x: cItem.target.x,\n                    y: cItem.target.y,\n                    width: cItem.target.offsetWidth,\n                    height: cItem.target.offsetHeight,\n                    successHandle: cItem.successHandle,\n                    failHandle: cItem.failHandle\n                });\n            }\n        }\n        /**\n         * 将一类事件拼接为一个处理器,并绑定至DOM\n         */\n        for (var type in eventTypeHash) {\n            var eventArray = eventTypeHash[type];\n            EventObject.DOMEventHandle[type] && smallcanvas.DOM.canvas.removeEventListener(type, EventObject.DOMEventHandle[type], false);\n            EventObject.DOMEventHandle[type] = createDomEventHandle(eventArray);\n            smallcanvas.DOM.canvas.addEventListener(type, EventObject.DOMEventHandle[type], false);\n        }\n\n        /**\n         * 使单点触控,多点触控返回统一的数据\n         * @returns {Array}\n         */\n        function getTouchPosition() {\n            var touchArray = []\n                , canvas = smallcanvas.DOM.canvas\n                , event = window['event']\n                ;\n            if (event['offsetX']) {\n                touchArray.push({\n                    x: event['offsetX'] / canvas['offsetWidth'] * canvas['width'],\n                    y: event['offsetY'] / canvas['offsetHeight'] * canvas['height']\n                })\n            } else {\n                var touches = event['touches'];\n                for (var i = 0; i < touches.length; i++) {\n                    touchArray.push({\n                        x: (touches[i]['clientX'] - canvas['offsetLeft']) / canvas['offsetWidth'] * canvas['width'],\n                        y: (touches[i]['clientY'] - canvas['offsetTop']) / canvas['offsetHeight'] * canvas['height']\n                    })\n                }\n            }\n            return touchArray;\n        }\n\n        /**\n         * 生成DOM事件处理函数\n         * @param eventArray\n         * @returns {function(): undefined}\n         */\n        function createDomEventHandle(eventArray) {\n            var resultFunction = function () {\n                var touchPosArray = getTouchPosition();\n                eventArray.forEach(function (item) {\n                    var isSuccess;\n                    touchPosArray.forEach(function (touchPos) {\n                        if (touchPos.x > item.x && touchPos.x < (item.x + item.width) && touchPos.y > item.y && touchPos.y < (item.y + item.height)) {\n                            isSuccess = true;\n                        }\n                    });\n                    isSuccess ? item.successHandle() : item.failHandle();\n                })\n            }\n            return resultFunction;\n        }\n\n\n    }\n\n\n    export function defaultHandle() {\n        console.log('这是默认事件');\n    }\n\n}"],"sourceRoot":"/source/"}